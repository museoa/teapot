#{{{script}}}#{{{ Linux at moria
#CFLAGS=		-g -pipe -O2 -Wall -Wmissing-prototypes -Wstrict-prototypes -Wcast-qual -Wpointer-arith -Wcast-align -Wwrite-strings -Wmissing-declarations -Wnested-externs -pedantic -fno-common
#CPPFLAGS=	-DHAVE_TYPEAHEAD
##CPPFLAGS=	-DHAVE_TYPEAHEAD -DTHE_ELECTRIC_FENCE
##CPPFLAGS=	-I/usr/dmalloc/include -DDMALLOC
#LDFLAGS=	-g
##LDFLAGS=	-g -L/usr/efence/lib
##LDFLAGS=	-g -L/usr/dmalloc/lib
#LIBS=		-lcurses -lm
##LIBS=		-lcurses -lm -lefence
##LIBS=		-lcurses -lm -ldmalloc
#MAKEDEPEND=	mkdep -d
#}}}
#{{{ Linux, SuSE 8.1, ncurses
#CC=		gcc
#CFLAGS=		-pipe -O2 -Wall -Wmissing-prototypes -Wstrict-prototypes -Wcast-qual -Wpointer-arith -Wcast-align -Wwrite-strings -Wmissing-declarations -Wnested-externs -pedantic -fno-common
#CPPFLAGS=	-I/usr/include/ncurses -DHAVE_TYPEAHEAD
#LDFLAGS=
#LIBS=		-lncurses -lm
#MAKEDEPEND=	gcc -MM
#}}}
#{{{ Solaris 9, gcc, ncurses
#CC=		gcc
#CFLAGS=		-pipe -O2 -Wall -Wmissing-prototypes -Wstrict-prototypes -Wcast-qual -Wpointer-arith -Wcast-align -Wwrite-strings -Wmissing-declarations -Wnested-externs -pedantic -fno-common
#CPPFLAGS=	-I/opt/FSFgnu/include -DHAVE_TYPEAHEAD
#LDFLAGS=	-L/opt/FSFgnu/lib
#LIBS=		-lcurses -lm -lnsl
#MAKEDEPEND=	gcc -MM
#}}}
#{{{ NetBSD 2.0
CC=		gcc
CFLAGS=		-g -pipe -O2 -Wall -Wmissing-prototypes -Wstrict-prototypes -Wcast-qual -Wpointer-arith -Wcast-align -Wwrite-strings -Wmissing-declarations -Wnested-externs -pedantic -fno-common
CPPFLAGS=
LDFLAGS=
LIBS=		-lm
MAKEDEPEND=	gcc -MM
#}}}

TEAPOTOBJS=	csv.o complete.o context.o eval.o func.o html.o \
		latex.o main.o misc.o parser.o sc.o scanner.o sheet.o \
		wk1.o xdr.o

teapot:		cat.h $(TEAPOTOBJS) display.o
		$(CC) $(LDFLAGS) -o $@ $^ $(LIBS) -lcurses

gteapot:		cat.h $(TEAPOTOBJS) display-gtk.o
		$(CC) $(LDFLAGS) -o $@ $^ $(LIBS) `pkg-config --libs gtk+-2.0` `pkg-config --libs gtkextra-2.0`

display-gtk.o: display-gtk.c help.h
		$(CC) $(CFLAGS) -c -o $@ $< `pkg-config --cflags gtk+-2.0` `pkg-config --cflags gtkextra-2.0` -Wno-strict-prototypes

cat.h:		Gencat
		./Gencat
		ln -s cat-en.h cat.h

help.h: doc/teapot.MM Genhelp
		make -C doc teapot.html
		./Genhelp

version.c:	Genversion
		./Genversion

display.o: version.c

graph:		graph.o csv.o
		$(CC) $(LDFLAGS) -o $@ graph.o csv.o -lm

wc:
		@wc -l *.[ch] | tail -1
		@wc -c *.[ch] | tail -1

depend:
		$(MAKEDEPEND) $(CPPFLAGS) *.c >.depend

clean:
		rm -f $(TEAPOTOBJS) graph.o display.o display-gtk.o help.h version.c cat.h cat-*
		(cd doc; make clean)

clobber:	clean
		rm -f core *.out teapot graph gteapot
		(cd doc; make clobber)

tar:		depend
		./Gencat
		(cd doc; make teapot.ps teapot.doc clean)
		(b=`pwd`; b=`basename $$b`; cd ..; tar zcvf $$b.tar.gz $$b/ANNOUNCE $$b/INSTALL $$b/doc $$b/magic $$b/teapot.1.* $$b/Makefile $$b/Gencat $$b/Genversion $$b/.depend $$b/.curses.h $$b/.nl_types.h $$b/*.c $$b/*.h $$b/examples)

include .depend		
